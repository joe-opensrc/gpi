#!/bin/bash

# Godot Project Initializer
rootDir="$( realpath $( dirname ${0} )/.. )"

projectComponentsDir="${rootDir}/project.godot.d"

resDir="${rootDir}/res"
dotDir="${rootDir}/dots"

pName="${1:-$( gum input --no-show-help --prompt 'Enter A Project Name: ' --placeholder='e.g., Galaxatron' --value=${pName} )}"
pName="${pName:-$( cat /dev/urandom | tr -dc 'A-Z0-9' | fold -w 9 | head -n 1 )}"

pOutDir="./${pName}"

if [[ -d "${pOutDir}" ]]
then
  echo "Cowardly refusing to modify existing directory!: ${pOutDir}" >&2
  exit 1
fi

pOutDir="${pOutDir}/godot"
pOutFile="${pOutDir}/project.godot"

mkdir -p "${pOutDir}"

cat $( find "${projectComponentsDir}" -mindepth 1 -printf '%p\n' | sort -V ) | sed -e "s/<|PNAME|>/${pName}/" >"${pOutFile}"

rsync -au "${resDir}/" "${dotDir}/" "${pOutDir}/"
